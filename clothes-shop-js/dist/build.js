(()=>{"use strict";const t="http://localhost:3000";Vue.component("basket",{data:()=>({goodsBasket:[],basket:[],sumGoods:""}),props:["goods"],template:'\n      <div v-if="goodsBasket.length !== 0" class="header__basket-inner">\n        <div class="header__basket" v-for="item in basket">\n          <div class="header__basket-item" itemid="456">\n            <div class="header__basket-img"></div>\n            <h3> {{item.product_name}} </h3>\n            <p> {{item.price}} </p>\n            <span class="header__amount-good"> {{sortingGood(item.id_product)}} </span>\n            <button v-on:click="removeGood(item.id_product)" type="button" class="header__btn-delet">\n                -\n            </button>\n          </div>\n        </div>\n        <div class="header__basket-total">\n          <div class="header__basket-total-list">\n            <div class="header__basket-title">Итого:</div>\n            <div class="header__basket-sum"> {{calculateSum()}} </div>\n          </div>\n        </div>\n      </div>\n    ',methods:{async addGood(t){for(let e=0;e<this.goods.length;e++)this.goods[e].id_product===+t.path[2].attributes[0].value&&await this.addToCart(this.goods[e]);await this.getToCart()},async addToCart(e){await fetch(`${t}/addToCart`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})},async getToCart(){const e=await fetch(`${t}/cartData`);if(e.ok){const t=await e.json();this.goodsBasket=t,this.basket=this.searchUniqueValues(this.goodsBasket),this.calculateGoods()}else alert("Ошибка при соединении с сервером")},searchUniqueValues(t){const e=[],o=[...new Set(t.map((t=>t.id_product)))];for(let s=0;s<o.length;s++)for(let a=0;a<t.length;a++)if(t[a].id_product===o[s]){e.push(t[a]);break}return e},calculateSum(){let t=0;return this.goodsBasket.forEach((e=>{t+=e.price})),t},calculateGoods(){this.goodsBasket.length>9?this.sumGoods="9+":this.sumGoods=this.goodsBasket.length,this.$emit("amount-goods",this.sumGoods)},sortingGood(t){let e=[];return this.goodsBasket.forEach((o=>{o.id_product===+t&&e.push(o)})),e.length},async removeToCart(e){await fetch(`${t}/removeToCart`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})},async removeGood(t){for(let e=this.goodsBasket.length-1;e>=0;e--)if(this.goodsBasket[e].id_product===+t){await this.removeToCart(this.goodsBasket[e]);break}await this.getToCart()}}}),Vue.component("form-serch",{data:()=>({searchLine:"",filteredProduct:[]}),props:["product"],template:'\n    <div class="header__form-inner">\n      <input \n        v-model="searchLine"\n        class="header__form-input" \n        type="search" \n        id="serch" \n        placeholder="Serch"\n      >\n      <button @click="filterGoods" class="header__form-btn-serch">Serch</button>\n    </div>\n    ',methods:{filterGoods(){this.filteredProduct=[],this.product.forEach((t=>{-1!==t.product_name.toUpperCase().indexOf(this.searchLine.toUpperCase())&&this.filteredProduct.push(t)})),this.$emit("products",this.filteredProduct)}}}),Vue.component("products-item",{props:["goodProp"],template:'\n      <li class="products__item" :itemId="goodProp.id_product">\n        <div class="products__wrapper-overlay">\n            <img class="products__item-img" src="./img/catalog/catalog-1.jpg" alt="Product"\n              width="360" height="420">\n            <button v-on:click="$emit(\'mouse-click\', $event)" class="products__button-cart" type="button">\n              Add to Cart\n            </button>\n        </div>\n        <div class="products__item-inner">\n            <h3 class="products__item-heading">\n              <a class="products__item-link" href="./product.html">\n                  {{goodProp.product_name}}\n              </a>\n            </h3>\n            <p class="products__item-text">\n              Known for her sculptural takes on traditional tailoring,\n              Australian arbiter of cool Kym\n              Ellery teams up with Moda Operandi.\n            </p>\n            <p class="products__item-price">\n              {{goodProp.price}}.00\n            </p>\n        </div>\n      </li>\n    '}),Vue.component("product-list",{props:["goods"],template:'\n      <ul class="products__list" v-if="goods.length !== 0">\n        <products-item \n          v-for="item in goods"\n          :goodProp="item"\n          :key="item.id_product"\n          @mouse-click="getClickOfProductsItem"\n        >\n        </products-item>\n      </ul>\n    ',methods:{getClickOfProductsItem(){const t=event;this.$emit("mouse-click",t)}}}),new Vue({el:"#app",data:{goods:[],filteredGoods:[],sumGoods:""},methods:{async getProducts(){const t=await fetch("http://localhost:3000/catalogData");if(t.ok){const e=await t.json();this.goods=e,this.filteredGoods=e}else alert("Ошибка при соединении с сервером")},getFilteredGoods(t){this.filteredGoods=t},getClickOfProductsItem(){this.$refs.basket.addGood(event)},getAmountGoods(t){this.sumGoods=t}},async mounted(){await this.getProducts(),await this.$refs.basket.getToCart()}})})();